<!DOCTYPE html>
<!--
    Type on Strap jekyll theme v2.2.4
    Copyright 2016-2019 Sylhare
    Theme free for personal and commercial use under the MIT license
    https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE
-->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Main JS (navbar.js, katex_init.js and masonry_init.js)-->
    <script defer src="/assets/js/main.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <!--Favicon-->
    <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon">

    <!-- Canonical -->
    <link rel="canonical" href="https://rykowski.dev/blog/flutter-unit-tests/">

    <!-- RSS -->
    <link rel="alternate" type="application/atom+xml" title="rykowski.dev" href="https://rykowski.dev/feed.xml"/>
    
    

    <!-- KaTeX 0.8.3 -->
    <!-- if you have any issue check https://github.com/KaTeX/KaTeX -->
    

    <!-- Google Analytics / Cookie Consent -->
    <script>
      const cookieName = 'cookie-notice-dismissed-https://rykowski.dev';
      const isCookieConsent = 'true';
      const analyticsName = 'UA-77793311-12';
    </script>

    
        <div id="cookie-notice"><span>Strona wykorzystuje pliki cookies.
          </span><a id="cookie-notice-accept" class="button">OK</a>
        </div>
    

    <!-- seo tags -->
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Wstęp do testowania przez testy jednostkowe | rykowski.dev</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Wstęp do testowania przez testy jednostkowe" />
<meta property="og:locale" content="pl_PL" />
<meta name="description" content="Każdy programista o nich słyszał, ale tylko niewielu przekłada je na praktykę. Czy warto? Zdecydowanie tak. Zwłaszcza jeśli chcesz być pewnym swojego kodu i uniknąć regresji w dłuższej perspektywie czasu." />
<meta property="og:description" content="Każdy programista o nich słyszał, ale tylko niewielu przekłada je na praktykę. Czy warto? Zdecydowanie tak. Zwłaszcza jeśli chcesz być pewnym swojego kodu i uniknąć regresji w dłuższej perspektywie czasu." />
<link rel="canonical" href="https://rykowski.dev/blog/flutter-unit-tests/" />
<meta property="og:url" content="https://rykowski.dev/blog/flutter-unit-tests/" />
<meta property="og:site_name" content="rykowski.dev" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-08T00:00:00+01:00" />
<script type="application/ld+json">
{"url":"https://rykowski.dev/blog/flutter-unit-tests/","headline":"Wstęp do testowania przez testy jednostkowe","dateModified":"2021-01-08T00:00:00+01:00","datePublished":"2021-01-08T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rykowski.dev/blog/flutter-unit-tests/"},"description":"Każdy programista o nich słyszał, ale tylko niewielu przekłada je na praktykę. Czy warto? Zdecydowanie tak. Zwłaszcza jeśli chcesz być pewnym swojego kodu i uniknąć regresji w dłuższej perspektywie czasu.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta property="og:image" content="https://rykowski.dev/assets/img/blog/unit_tests/thumbnail.png">

    <!-- Twitter Cards -->
    <meta name="twitter:title" content="Wstęp do testowania przez testy jednostkowe">
    <meta name="twitter:description" content="Gdybym w eter rzucił hasło “Pisanie kodu” to pierwszą myślą przychodzącą ci do głowy jest zapewne zakodowanie nowej funkcjonalności. Ewentualnie naprawa błęd...">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://rykowski.dev/assets/img/blog/unit_tests/thumbnail.png">
</head>

  <body>
    <header class="site-header">

    <!-- Logo and title -->
	<div class="branding">
        

		<h1 class="site-title">
			<a aria-label="rykowski.dev" href="/">
        rykowski.dev
      </a>
		</h1>
	</div>

    <!-- Toggle menu -->
    <nav class="clear">
    <a aria-label="pull" id="pull" class="toggle" href="#">
    <i class="fa fa-bars fa-lg"></i>
    </a>

    <!-- Menu -->
    <ul class="hide">
        

        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="O mnie" title="O mnie" href="/about/">
                     O mnie 
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Wystąpienia" title="Wystąpienia" href="/talks/">
                     Wystąpienia 
                </a>
            </li>
            
            
        
            
            <li class="separator"> | </li>
            <li>
                <a class="clear" aria-label="Wyszukiwarka" title="Wyszukiwarka" href="/search/">
                     <i class="fa fa-search" aria-hidden="true"></i>
                    
                </a>
            </li>
            
            
        
            
            
        
            
            
        
            
            
        
    </ul>

	</nav>
</header>

    <div class="content">
      <article class="feature-image" >
  <header id="main" style="">
    <div class="title-padder">
      
      <h1 id="Wst%C4%99p+do+testowania+przez+testy+jednostkowe" class="title">Wstęp do testowania przez testy jednostkowe</h1>
      


<div class="post-info">
    <p class="meta">
      
      
      Styczeń
        
      2021
    </p></div>

      
    </div>
  </header>

  <section class="post-content">
  
      <p>Gdybym w eter rzucił hasło <em>“Pisanie kodu”</em> to pierwszą myślą przychodzącą ci do głowy jest zapewne zakodowanie nowej funkcjonalności. Ewentualnie naprawa błędu zgłoszonego przez <del>ten upierdliwy</del> dział QA, mimo tego, że z kodu jasno wynika, że aplikacja nie może się tutaj crashować! Istnieje jednak jeszcze jeden aspekt pisania kodu, a mianowicie pisanie <strong>testów</strong>. To ten mityczny twór typu <em>każdy wie że trzeba to robić, nikt nie ma czasu na głupoty</em>.</p>

<p><strong>Czym tak właściwie są te testy?</strong> Niezależną częścią aplikacji (w postaci kodu), która powstaje z boku i sama w sobie nie ma specjalnej wartości dla użytkownika końcowego. Na prawdę nie da się powiedzieć, że testy są integralną częścią aplikacji, nawet jeśli skacze ci teraz ciśnienie z powodu testo-dyskryminacji. Można je pisać, można nie, możesz nawet wyrzucić wszystkie istniejące testy z projektu, a aplikacja nadal będzie działała tak samo. Tak to już jest.</p>

<p>W takim razie po co wkładać jakikolwiek wysiłek w coś czego nie zauważy nikt poza zespołem technicznym? No właśnie po to. Zespół developerski jest głównym beneficjentem istnienia testów. Gwarantują one (nigdy w 100%), że aplikacja działa poprawnie, nawet bez konieczności jej uruchamiania i ręcznego przeklikiwania. Wszystkim zajmuje się automat stwierdzający zero-jedynkowo, czy masz kod pod kontrolą, czy właśnie coś skopałeś dodając nową funkcjonalność, lub refaktorując istniejące już rozwiązanie.</p>

<h2 id="ogólnie-o-testach">Ogólnie o testach</h2>

<p>Pisanie testów jest łatwe i trudne zarazem. Zależy od której strony na nie spojrzeć i jakimi standardami podążąmy w firmie w której budujemy aplikacje. Pracowałem w projektach betonowych, gdzie pisanie testów nie było mile widziane. Nie mają przecież żadnej wartości, klient nie będzie za nie płacił. Poza tym testy są dla programistów niepewnych swojego kodu, czyli słabych. <em>Biznesowy beton</em>. Może być on twoim największym przeciwnikiem w pisaniu testów. Mam jednak dobrą wiadomość! Podejście to mocno odeszło do lamusa w ostatnich latach i nie spotykam się już ze szlabanem na testy. Wzrosła ogólna świadomość odnośnie wytwarzania oprogramowania. Sukces!</p>

<p>Łatwą stroną pisania testów jest natomiast część techniczna. Wystarczy poznać podstawy, a cała reszta idzie dosłownie z górki. Nie ma tutaj dużego pola do manewru, czy nauki. Ot napisać trochę kodu, który jest mocno uniwersalny między wszystkimi dostępnymi technologiami. Zaufaj mi, łatwizna. Zresztą za chwilę będziesz miał okazję zobaczyć sam wszystko w akcji.</p>

<h3 id="korzyści-z-posiadania-testów">Korzyści z posiadania testów</h3>

<p>Dlaczego tak na prawdę programiści chcą pisać testy? Nie dość im kodu w samej aplikacji i mają wymyślną fanaberię na klepanie czegoś z boku? <em>Otóż nie tym razem</em>. Korzyści są i to namacalne, nawet jeśli nie przekładające się wprost na samo działanie aplikacji.</p>

<ol>
  <li><strong>Testowanie różnych scenariuszy bez konieczności ręcznego przeklikiwania</strong>. Bo co zrobić, gdy funkcja którą chcesz sprawdzić, jest uruchamiana gdzieś głęboko w aplikacji, a zmiana parametrów z którymi jest wywoływana to minuty stukania po różnych ekranach?</li>
  <li><strong>Raz napisany test pozostaje z projektem na zawsze</strong>, a przynajmniej do momentu w którym nie zostanie usunięty podczas większego refaktoringu. Dzięki temu wystarczy jednorazowo napisać test, a wyniku używać do woli.</li>
  <li><strong>Możliwość konfiguracji <em>CI</em></strong>, aby automatycznie uruchamiał testy podczas zmian w kodzie. Wykryje to potencjalne regresje w aplikacji, nawet gdy bezpośrednio nie dotykałeś danej funkcji.</li>
  <li><strong>Spokój ducha i dobry sen</strong>. Nie czujesz przerażenia przed wypuszczaniem aplikacji w świat, bo może nie działać. Na pewno działa, bo testy pilnują cię 24/7. Raczej na <em>prawie pewno</em>, bo i tak zawsze znajdą się mniejsze lub większe błędy. Grunt to minimalizacja ryzyka.</li>
</ol>

<p>Taka porcja zalet chyba wystarczy? Poza tym - zapytaj dowolnego doświadczonego programistę, czy pisanie testów ma sens. Nie ma innej opcji niż odpowiedź twierdząca, nawet jeśli z różnych powodów piszemy ich mniej niż byśmy chcieli. <em>Życie to nie bajka, ale nie róbmy z niego koszmaru</em>.</p>

<h3 id="typy-testów">Typy testów</h3>

<p>Test testowi nierówny. Nie będę się zagłębiał w zbędny wywód teoretyczny i opisywał całej rodziny gatunków testów, bo … nie umiem. Zabawne jest to, ile różnych rodzajów testów istnieje i które trudno jest sklasyfikować programiście nawet z wieloletnim stażem. Najbardziej znanymi i uskutecznianymi w większości firm są <strong>testy jednostkowe</strong> oraz <strong>testy integracyjne</strong>. Generalnie to do szczęśliwości na poziomie 90% wystarczą jedynie te dwa, a resztę pozostawiam purysto-fanatykom.</p>

<h4 id="testy-jednostkowe">Testy jednostkowe</h4>

<p>Najprostsze. Najłatwiejsze. Produkowane w ilościach hurtowych. Trzon i fundament testów każdej aplikacji. <strong>Polegają na pokryciu pojedynczego fragmentu kodu</strong> - klasy, czy funkcji - przypadkami testowymi. Jak wygląda to w realnym świecie? Przyjmijmy, że masz już własny projekt. Kompiluje się, działa. Robi różne rzeczy. Nagle postanawiasz, że pora dodać trochę testów. Generalnie to lepiej jakby były pisane na bieżąco, ale jest jak jest. Co zrobić? Jak zacząć?</p>

<ol>
  <li>Otwórz losowy plik</li>
  <li>Znajdź w nim funkcję</li>
  <li>Napisz testy sprawdzające czy funkcja działa zgodnie z oczekiwaniami</li>
  <li>Powtarzaj do skutku</li>
</ol>

<p>W wyimaginowanym projekcie natrafiamy na niepozorną funkcję, która zwraca nazwę miesiąca na podstawie dostarczonej daty. Przemilczmy fakt, że istnieją gotowe rozwiązania tego typu i skupmy się na przykładzie.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">String</span> <span class="nf">getMonthName</span><span class="p">(</span><span class="n">DateTime</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">switch</span> <span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">month</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="k">return</span> <span class="s">"styczeń"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="k">return</span> <span class="s">"luty"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span> <span class="k">return</span> <span class="s">"marzec"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">4</span><span class="o">:</span> <span class="k">return</span> <span class="s">"kwiecień"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">5</span><span class="o">:</span> <span class="k">return</span> <span class="s">"maj"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">7</span><span class="o">:</span> <span class="k">return</span> <span class="s">"lipiec"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">8</span><span class="o">:</span> <span class="k">return</span> <span class="s">"sierpień"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">9</span><span class="o">:</span> <span class="k">return</span> <span class="s">"wrzesień"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">10</span><span class="o">:</span> <span class="k">return</span> <span class="s">"paźdzeirnik"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">11</span><span class="o">:</span> <span class="k">return</span> <span class="s">"listopad"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">12</span><span class="o">:</span> <span class="k">return</span> <span class="s">"grudzień"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Nie ma testów, bo po co? <strong>Błąd.</strong> Problemy czychają wszędzie, zwłaszcza w najmniej spodziewanych fragmentach kodu. Napiszmy więc testy, aby upewnić się, że wszystko działa jak należy. Bułka z masłem.</p>

<p>Zanim to jednak zrobimy, warto odpowiedzieć sobie na zasadnicze pytanie - gdzie przechowywać pliki z testami? Warto trzymać się domyślnej konwencji, w której każdy nowo utworzony projekt we Flutterze posiada katalog <code class="language-plaintext highlighter-rouge">test</code>. Osobiście odzwierciedlam niemal 1:1 strukturę plików i katalogów z głównej aplikacji, w taki sposób, że jeśli mam przykładowo plik <code class="language-plaintext highlighter-rouge">lib/ui/routes/home.dart</code> do wyświetlania ekranu głównego, to mam również jego lustrzane odbicie które przechowuje testy w <code class="language-plaintext highlighter-rouge">test/ui/routes/home_test.dart</code>. Druga zasada dotyczy nazewnictwa pliku. <strong>Nazwa musi kończyć się na <code class="language-plaintext highlighter-rouge">_test.dart</code>.</strong> Bez wyjątku. Pamiętaj o tej zasadzie i przypomnij ją sobie, gdy pewnego dnia napiszesz kolejne testy i okaże się, że polecenie do ich uruchamiania całkowicie ignoruje wszystkie przypadki testowe.</p>

<p>Formalności za nami, pora utworzyć plik z testami dla funkcji określającej nazwę miesiąca. Załóżmy, że znajduje się ona w pliku <code class="language-plaintext highlighter-rouge">lib/utils.dart</code>, więc testy najlepiej zaprogramować w <code class="language-plaintext highlighter-rouge">test/utils_test.dart</code>.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'package:flutter_tests/utils.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:test/test.dart'</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">group</span><span class="o">(</span><span class="s">'getMonthName'</span><span class="o">,</span> <span class="o">()</span> <span class="o">{</span>
    <span class="n">test</span><span class="o">(</span><span class="s">'returns correct name for january'</span><span class="o">,</span> <span class="o">()</span> <span class="o">{</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">DateTime</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">15</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"styczeń"</span><span class="o">));</span>
    <span class="o">});</span>

    <span class="n">test</span><span class="o">(</span><span class="s">'returns correct name for february'</span><span class="o">,</span> <span class="o">()</span> <span class="o">{</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">DateTime</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">15</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"luty"</span><span class="o">));</span>
    <span class="o">});</span>

    <span class="c1">// ...</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Przyjrzyjmy się strukturze testów. Po pierwsze importowana jest oficjalna paczka <a href="https://pub.dev/packages/test" target="_blank">test</a>, będąca podstawowym i niezbędnym narzędziem w pisaniu testów. Tak jak do napisania aplikacji mobilnej wymagany jest <em>Flutter</em>, tak do testów potrzebna jest paczka <em>test</em>.</p>

<p>Druga istotna rzecz to fakt, że każdy plik z testami jest samodzielnym zestawem i wymaga punktu wejściowego w postaci funkcji <code class="language-plaintext highlighter-rouge">main</code>. Uruchamiając testy to właśnie ta funkcja jest wywoływana, aby ustalić co należy wykonać w następnych krokach. Zupełnie tak jak <code class="language-plaintext highlighter-rouge">main</code> głównej aplikacji.</p>

<p>Trzeci aspekt to już stricte składnia pisania testów. Funkcja <code class="language-plaintext highlighter-rouge">group</code> służy jedynie do logicznego zgrupowania wielu pojedynczych testów, które sprawdzają ten sam element systemu, ale pod różnym kątem. Osobiście najczęściej wpisuję tutaj po prostu nazwę klasy, lub funkcji którą będę za chwilę testował. Sprawdza się, zwłaszcza że nic nie stoi na przeszkodzie, aby grupy dowolnie zagnieżdzać w razie potrzeby. W ten sposób łatwo jest zdefiniować grupę nadrzędną dla klasy oraz podgrupy reprezentujące jej pojedyncze metody.</p>

<p>Zdecydowanie ciekawszym elementem są funkcje <code class="language-plaintext highlighter-rouge">test</code>, odpowiadające za konkretne przypadki testowe. Otrzymują bardziej opisową nazwę, mówiącą co dokładnie dany test sprawdza. Jeśli nie potrafisz zmieścić się w jednej linii z opisem takiego testu - znaczy, że robi za dużo i należy go rozbić na kilka mniejszych! Pamiętaj, że rozmawiamy o testach jednostkowych, a ich zadaniem jest testowanie pojedynczej jednostki, a nie całego układu. Zbyt obszerne testy jednostkowe, mimo że nadal gwarantują działanie systemu to są diabelnie czasochłonne w utrzymywaniu i podatne na częste zmiany. <strong>Unikaj zbyt złożonych testów jednostkowych jak ognia!</strong></p>

<p>A co siedzi w środku pojedynczego testu? W naszym przypadku są to testy banalne, jednolinijkowe. Nic nie stoi jednak na przeszkodzie, aby linii było więcej - tak się dzieje w prawdziwym świecie oprogramowania. Oczekujemy (<code class="language-plaintext highlighter-rouge">expect</code>), że wynik zwrócony przez funkcję <code class="language-plaintext highlighter-rouge">getMonthName</code>, będzie równy (<code class="language-plaintext highlighter-rouge">equals</code>) określonej wartości. I tak w pierwszym teście wywołujemy naszą funkcję podając jej jako parametr <code class="language-plaintext highlighter-rouge">DateTime(2020, 1, 15)</code> i oczekujemy że zwrócony zostanie napis <code class="language-plaintext highlighter-rouge">styczeń</code>. Tylko skąd wziąłem tą datę? Z głowy! Równie dobrze mógłbym podać rok <code class="language-plaintext highlighter-rouge">1988</code>, albo <code class="language-plaintext highlighter-rouge">2018</code> - nie ma to znaczenia. Najważniejsze, żeby miesiąc się zgadzał, bo to on jest istotny dla funkcji <code class="language-plaintext highlighter-rouge">getMonthName</code>.</p>

<p>W ten sposób otrzymujemy 12 testów i z jednej strony jest to super, bo są małe, a z drugiej mocno zahacza o przerost formy nad treścią. Wybór należy do ciebie, ale zdecydowanie wolę mniej kodu niż więcej i chętnie zbiorę to wszystko w pojedynczy test:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'package:flutter_tests/utils.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:test/test.dart'</span><span class="o">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">group</span><span class="o">(</span><span class="s">'getMonthName'</span><span class="o">,</span> <span class="o">()</span> <span class="o">{</span>
    <span class="n">test</span><span class="o">(</span><span class="s">'returns correct names'</span><span class="o">,</span> <span class="o">()</span> <span class="o">{</span>
      <span class="n">DateTime</span> <span class="n">getDate</span><span class="o">(</span><span class="kt">int</span> <span class="n">month</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">DateTime</span><span class="o">(</span><span class="mi">2020</span><span class="o">,</span> <span class="n">month</span><span class="o">,</span> <span class="mi">15</span><span class="o">);</span>

      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">1</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"styczeń"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">2</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"luty"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">3</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"marzec"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">4</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"kwiecień"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">5</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"maj"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">6</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"czerwiec"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">7</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"lipiec"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">8</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"sierpień"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">9</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"wrzesień"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">10</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"październik"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">11</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"listopad"</span><span class="o">));</span>
      <span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">12</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"grudzień"</span><span class="o">));</span>
    <span class="o">});</span>
  <span class="o">});</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Pokrycie przypadków jest identyczne, sprawdzone zostały wszystkie możliwe miesiące. Skoro nie widać różnicy i test nadal pozostaje czytelny w swojej nowej formie - warto się pochylić nad takim ułatwieniem. Jedyną ceną takiego rozwiązania jest fakt, że przy ewentualnych błędach funkcji <code class="language-plaintext highlighter-rouge">getMonthName</code> test zostanie przerwany w momencie odnalezienia pierwszego problemu. Nie wykona wszystkich dostępnych instrukcji, więc jeśli funkcja zwracałaby błędny wynik dla lutego i grudnia to test poinformuje nas o błędzie w lutym, a dopiero po jego naprawieniu pojawi się informacja, że grudzień również działa niepoprawnie. W prostych funkcjach jest to kompromis na który można sobie pozwolić, lecz przy bardziej złożonych warto postawić na rozbicie. Tak czy inaczej - życie weryfikuje, które podejścia działa najlepiej dla danego przypadku. Kwestia wprawy.</p>

<h4 id="uruchamianie-testów">Uruchamianie testów</h4>

<p>Testy mamy przygotowane, pora je uruchomić i zweryfikować, czy funkcja <code class="language-plaintext highlighter-rouge">getMonthName</code> działa zgodnie z założeniami. <em>Flutter</em> udostępnia własną komendę do uruchamiania testów, której zadaniem jest uruchomienie wszystkich dostępnych plików z testami (<code class="language-plaintext highlighter-rouge">*_test.dart</code>) znajdujących się w katalogu <code class="language-plaintext highlighter-rouge">test/</code>.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flutter</span> <span class="n">test</span>
</code></pre></div></div>

<p>Po dosłownie sekundzie otrzymujemy wynik … negatywny. Testy się wysypały z odpowiednimi informacjami dla programisty.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ flutter <span class="nb">test
</span>00:01 +0 <span class="nt">-1</span>: getMonthName returns correct names <span class="o">[</span>E]
  Expected: <span class="s1">'czerwiec'</span>
    Actual: &lt;null&gt;
     Which: not an &lt;Instance of <span class="s1">'String'</span><span class="o">&gt;</span>

  package:test_api      expect
  utils_test.dart 14:7  main.&lt;fn&gt;.&lt;fn&gt;

00:01 +0 <span class="nt">-1</span>: Some tests failed.
</code></pre></div></div>

<p>Czytanie logów tego typu to codzienność. Wygląda to analogicznie jak wertowanie stosu aplikacji w momencie wystąpienia nieoczekiwanego wyjątku (<em>stack trace</em>). Należy przejrzeć komunikat i znaleźć w nim istotne informacje, które naprowadzą nas do naprawienia testu, bądź kodu który właśnie testujemy.</p>

<p>Na samej górze mamy wskaźnik na test, który zakończył się niepowodzeniem. Grupa <code class="language-plaintext highlighter-rouge">getMonthName</code>, test <code class="language-plaintext highlighter-rouge">returns correct names</code>. Nie jest to może najistotniejsza informacja w momencie, gdy mamy tylko jeden test na całą aplikację, ale zyskuje na wartości gdy testów powstaje coraz więcej i więcej. Oczywiste.</p>

<p>Sam test twierdzi, że oczekiwał napisu <strong>czerwiec</strong>, a zamiast niego otrzymał bezczelny obiekt <strong>null</strong>. Ma sens, w końcu <em>czerwiec ≠ null</em>. Dodatkowo pojawia się informacja, że błąd wystąpił w pliku <em>utils_test.dart</em> w linii 14. Spójrzmy, co podejrzanego robi wskazany fragment!</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ok</span>
<span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">5</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"maj"</span><span class="o">));</span>
<span class="c1">// not ok</span>
<span class="n">expect</span><span class="o">(</span><span class="n">getMonthName</span><span class="o">(</span><span class="n">getDate</span><span class="o">(</span><span class="mi">6</span><span class="o">)),</span> <span class="n">equals</span><span class="o">(</span><span class="s">"czerwiec"</span><span class="o">));</span>
</code></pre></div></div>

<p>Nie ma tutaj nic podejrzanego. Żadnego kandydata na błąd w teście. Szczególnie, że przypadki dla poprzednich miesięcy zadziałały prawidłowo. Skoro tak - trzeba spojrzeć na właściwą implementację funkcji <code class="language-plaintext highlighter-rouge">getMonthName</code>, aby dowiedzieć się, dlaczego błędnie obsługuje miesiąc czerwiec.</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">String</span> <span class="nf">getMonthName</span><span class="p">(</span><span class="n">DateTime</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">switch</span> <span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">month</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">case</span> <span class="mi">5</span><span class="o">:</span> <span class="k">return</span> <span class="s">"maj"</span><span class="o">;</span>
    <span class="k">case</span> <span class="mi">7</span><span class="o">:</span> <span class="k">return</span> <span class="s">"lipiec"</span><span class="o">;</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Bingo! Zabrakło obsługi na <code class="language-plaintext highlighter-rouge">case 6</code>. Czyli jednak prawdziwy błąd, który wyłapał za nas test! A teraz wyobraź sobie sytuację, w której napisałeś powyższy kod i używasz go do zaprezentowania obecnej daty użytkownikowi. Jest styczeń - wszystko działa poprawnie. Funkcjonalność trafia na produkcję. Wszyscy o niej zapominają w kolejnych miesiącach. Nagle w nocy z 31 maja na 1 czerwca aplikacja wybucha, przestaje działać stabilnie. W oczach łzy, a myśl tylko jedna.</p>

<blockquote>
  <p>Sef nie ksycy, ja nie panimaju.</p>
</blockquote>

<p>Sama historia jest nieco podkoloryzowana (ziarno prawdy zasiane na bazie własnych doświadczeń), ale jestem pewien że rozumiesz do czego zmierzam. Po naprawieniu funkcji rzucamy raz jeszcze okiem, czy nie brakuje może dodatkowego <em>case</em> i ponownie uruchamiamy testy.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ flutter <span class="nb">test
</span>00:01 +0 <span class="nt">-1</span>: getMonthName returns correct names <span class="o">[</span>E]
  Expected: <span class="s1">'październik'</span>
    Actual: <span class="s1">'paźdzeirnik'</span>
     Which: is different.
            Expected: październik
              Actual: paźdzeirnik
                           ^
             Differ at offset 5

  package:test_api      expect
  utils_test.dart 18:7  main.&lt;fn&gt;.&lt;fn&gt;

00:01 +0 <span class="nt">-1</span>: Some tests failed.
</code></pre></div></div>

<p>Co tym razem? Błąd jakiś inny, ale to dalej nie jest sukces. Zakorkuj szampana, pora wracać do pracy! Test oczekiwał napisu <code class="language-plaintext highlighter-rouge">październik</code> i właśnie taki dostał - <code class="language-plaintext highlighter-rouge">paźdzeirnik</code>. Jeszcze próbuje się tłumaczyć, że jest różnica na 5 pozycji (indeksowane od zera). Nawet strzałeczkę w ASCII narysował. Przyglądamy się bliżej i … jest! Literówka. Kaliber błędu mniejszy niż poprzednio, bo przynajmniej aplikacja nie wybucha, ale to dalej dziura do załatania.</p>

<p>Szybka runda poprawkowa, ponowne uruchomienie testów.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flutter <span class="nb">test
</span>00:01 +1: All tests passed!
</code></pre></div></div>

<p>Wszystkie (słownie jeden) testy przeszły poprawnie. Nie ma więcej błędów, misja zakończona. Można taki kod bezpiecznie dodać do aplikacji i spać spokojnie, bez nocnych telefonów o niespodziewanej awarii. Jakie to uczucie? <strong>Miłe.</strong></p>

<h4 id="testy-integracyjne">Testy integracyjne</h4>

<p>Testy jednostkowe są świetne i powinny stanowić kluczowy system obronny przed błędami i regresją w kodzie. Sprawdzają poprawność działania małych, odizolowanych od siebie fragmentów aplikacji. W rzeczywistości to jednak trochę za mało, aby czuć się w pełni bezpiecznym. Co z tego, że repozytoria poprawnie operują na danych, stan odpowiednio reaguje na zadane zdarzenia, czy funkcje pomocnicze dobrze określają nazwę dnia miesiąca, skoro aplikacja jako całość wysypuje się w momencie startu, bądź działa w sposób nieoczekiwany?</p>

<p>Właśnie do testowania aplikacji jako całości służą <strong>testy integracyjne</strong>. Mają za zadanie uruchomić aplikację tak jak robi to prawdziwy użytkownik i zweryfikować jej działanie na żywym organizmie. W przypadku aplikacji mobilnej na urządzeniu fizycznym, bądź wirtualnym.</p>

<ul>
  <li>Czy da się zarejestrować nowe konto wypełniając formularz z pierwszego ekranu?</li>
  <li>Czy aplikacja zwraca się do mnie po imieniu, które podałem podczas rejestracji?</li>
  <li>Czy mogę na liście produktów odnaleźć daną pozycję i dodać ją do koszyka stukając w odpowiedni przycisk?</li>
  <li>…</li>
</ul>

<p>Wszystkie powyższe pytania są słuszne. Nawet pomimo faktu, że testy jednostkowe pokrywają te funkcjonalności. Robią to na dużo niższym poziomie, który nie zawsze odzwierciedla efekt końcowy w postaci aplikacji dostarczanej użytkownikowi.</p>

<p>O testach integracyjnych we <em>Flutterze</em> przeczytasz w <a href="/blog/flutter-driver-tests/">następnym wpisie</a>, który jest dedykowany właśnie temu konkretnemu zagadnieniu. Framework mocno nas rozpieszcza i również tym razem dostarczy gotowe i wbudowane rozwiązanie.</p>

<h2 id="podsumowanie">Podsumowanie</h2>

<p>Pisanie testów nie jest procesem skomplikowanym. Powtarzalnym? Owszem. Trzeba się jednak przemóc i stopniowo wdrażać testy, szczególnie do krytycznych elementów systemu, których działanie jest złożone, a testowanie ręczne trudne, bądź czasochłonne. W takim przypadku raz napisane testy, bardzo szybko się zwrócą, a ty nie musisz przy każdej drobnej zmianie sprawdzać, czy nic po drodze nie wybuchło. Poczucie komfortu przy pracy z otestowanym projektem jest nieporównywalnie wyższe, niż gdy takowych brak. Nie zatracaj się jednak w pisaniu testów jako <em>sztuka dla sztuki</em> i nie testuj na siłę każdej jednej linii w kodzie. Znajdź umiar i równowagę, a testy staną się twoim przyjacielem.</p>

<p>Kod pełnej aplikacji znajdziesz na <a href="https://github.com/vintage/flutter_demo_unit_tests">GitHubie</a>.</p>

<p>A jak pisanie testów wygląda w twoim projekcie? Napisałeś, dopiero zaczynasz, czy może nie wierzysz w ich pozytywny wpływ na życie projektu? <strong>Daj znać!</strong></p>

    
  </section>

  <!-- Social media shares -->
  

<div class="share-buttons">
    <ul class="share-buttons">
        <div class="meta">Podziel się na</div>
        
        <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Frykowski.dev%2Fblog%2Fflutter-unit-tests%2F" target="_blank" title=" Facebook">
			<i class="fa fa-facebook-square fa-2x" aria-hidden="true"></i>
			<span class="sr-only">Share on Facebook</span>
		</a>
        </li>
         
        <li>
            <a href="https://twitter.com/intent/tweet?text=Wst%C4%99p+do+testowania+przez+testy+jednostkowe%20https%3A%2F%2Frykowski.dev%2Fblog%2Fflutter-unit-tests%2F" target="_blank" title="">
			<i class="fa fa-twitter-square fa-2x" aria-hidden="true"></i>
			<span class="sr-only">Tweet</span>
		</a>
        </li>
            
        <li>
            <a href="http://www.reddit.com/submit?url=https://rykowski.dev/blog/flutter-unit-tests/&title=Wst%C4%99p+do+testowania+przez+testy+jednostkowe%20%7C%20rykowski.dev" target="_blank" title=" Reddit">
			<i class="fa fa-reddit-square fa-2x" aria-hidden="true"></i>
			<span class="sr-only">Share on Reddit</span>
		</a>
        </li>
           
        <li>
            <a href="mailto:?subject=Wst%C4%99p+do+testowania+przez+testy+jednostkowe%20%7C%20rykowski.dev&body=:%20https://rykowski.dev/blog/flutter-unit-tests/" target="_blank" title="">
			<i class="fa fa-envelope-square fa-2x" aria-hidden="true"></i>
			<span class="sr-only">Email</span>
		</a>
        </li>
        
    </ul>
</div>




   <!-- Tag list -->
  
  


<footer>
  <div class="tag-list"></div>
</footer>


</article>

<!-- Disqus -->

<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'rykowski-dev';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Włącz obsługę JavaScript, aby wyświetlić komentarze</noscript>
</div>


<!-- Post navigation -->

  <div id="post-nav">
    
    <div id="previous-post">
        <a alt="Testy integracyjne z Flutter Driverem" href="/blog/flutter-driver-tests/">
            <p>Poprzedni wpis</p>
            Testy integracyjne z Flutter Driverem
        </a>
    </div>
    

    
    <div id="next-post">
        <a alt="Schludny i czysty kod" href="/blog/flutter-linter/">
            <p>Następny wpis</p>
            Schludny i czysty kod
        </a>
    </div>
    
</div>



<!-- To change color of links in the page -->
<style>
  
  .feature-image a { color: rgb(69,190,247) !important; }
  div#post-nav a { color: rgb(69,190,247) !important; }
  footer a { color: rgb(69,190,247) !important; }
  .site-header nav a:hover {  color: rgb(69,190,247) !important; }
  header#main { background-color: rgb(69,190,247) !important; }
  

  header#main {
    background-repeat:no-repeat;
  background-image: url('/assets/img/lineart.png');  
  }
</style>

    </div>
    <footer class="site-footer">
    <p class="text">
        Powered by <a href="https://jekyllrb.com/">Jekyll</a> with <a href="https://github.com/sylhare/Type-on-Strap">Type on Strap</a>
</p>
            <div class="footer-icons">
                <ul>
                <!-- Social icons from Font Awesome, if enabled -->
                
<li>
    <a feed.xml href="/feed.xml"
       title="Obserwuj kanał RSS">
        <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>



<li>
    <a href="mailto:kamil.rykowski@gmail.com" title="Email">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>













<li>
    <a href="https://github.com/vintage" title="Obserwuj na GitHub">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>

























<li>
    <a class="type" href="https://twitter.com/KamilRykowski"
       title="Obserwuj na Twitter">
        <span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
        </span>
    </a>
</li>








                </ul>
            </div>
</footer>




    
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.2.4/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/8.2.4/firebase-analytics.js"></script>

        <script>
          // Your web app's Firebase configuration
          // For Firebase JS SDK v7.20.0 and later, measurementId is optional
          var firebaseConfig = {
            apiKey: "AIzaSyCSA6ySh9pwqKegEs_93eY6Ex7DaREU_bs",
            authDomain: "rykowski-dev.firebaseapp.com",
            projectId: "rykowski-dev",
            storageBucket: "rykowski-dev.appspot.com",
            messagingSenderId: "991787015203",
            appId: "1:991787015203:web:9b1cc3e14b5bee14dd6596",
            measurementId: "G-J237EH2RK0"
          };
          // Initialize Firebase
          firebase.initializeApp(firebaseConfig);
          firebase.analytics();
        </script>
    
  </body>
</html>
